<!doctype html>
<html lang="en" class="theme-fs-sm" data-bs-theme="light" data-bs-theme-color="default" dir="ltr">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Tạo hồ sơ bệnh án - KiviCare</title>
    <!-- Import existing CSS files -->
    <link rel="shortcut icon" href="./assets/images/favicon.ico" />
    <link rel="stylesheet" href="./assets/css/core/libs.min.css" />
    <link rel="stylesheet" href="./assets/css/kivicare.min.css?v=1.4.1" />
    <link rel="stylesheet" href="./assets/css/custom.min.css?v=1.4.1" />
    
    <!-- Custom CSS for this page -->
    <style>
        .form-section {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0.375rem;
        }
        .required {
            color: #dc3545;
        }
        .char-counter {
            font-size: 0.875rem;
            color: #6c757d;
        }
        .char-counter.warning {
            color: #ffc107;
        }
        .char-counter.danger {
            color: #dc3545;
        }
    </style>
</head>
<body class="">
    <!-- Include existing sidebar -->
    <aside class="sidebar sidebar-base" id="first-tour" data-toggle="main-sidebar" data-sidebar="responsive">
        <div class="sidebar-header d-flex align-items-center justify-content-start position-relative">
            <a href="./doctor-dashboard.html" class="navbar-brand">
                <div class="logo-main">
                    <img class="logo-normal img-fluid" src="./assets/images/logo.png" height="30" alt="logo">
                    <img class="logo-mini img-fluid" src="./assets/images/logo-mini.png" height="30" alt="logo">
                </div>
            </a>
        </div>
        
        <div class="sidebar-body pt-0 data-scrollbar">
            <div class="sidebar-list">
                <ul class="navbar-nav iq-main-menu" id="sidebar-menu">
                    <li class="nav-item static-item">
                        <a class="nav-link static-item disabled text-start" href="#" tabindex="-1">
                            <span class="default-icon">Doctor Panel</span>
                            <span class="mini-icon">-</span>
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="./doctor-dashboard.html">
                            <span class="item-name">My Dashboard</span>
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="./my-appointments.html">
                            <span class="item-name">My Appointments</span>
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link" href="./patient-schedule.html">
                            <span class="item-name">Chi tiết lịch khám</span>
                        </a>
                    </li>
                    
                    <li class="nav-item">
                        <a class="nav-link active" href="#" onclick="return false;">
                            <span class="item-name">Tạo hồ sơ bệnh án</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </aside>

    <main class="main-content">
        <div class="position-relative">
            <!-- Navigation -->
            <nav class="nav navbar navbar-expand-xl navbar-light iq-navbar">
                <div class="container-fluid navbar-inner">
                    <a href="./doctor-dashboard.html" class="navbar-brand">
                        <div class="logo-main"></div>
                    </a>
                    
                    <div class="sidebar-toggle" data-toggle="sidebar" data-active="true">
                        <i class="icon d-flex"></i>
                    </div>
                    
                    <div class="collapse navbar-collapse" id="navbarSupportedContent">
                        <ul class="mb-2 navbar-nav ms-auto align-items-center navbar-list mb-lg-0">
                            <!-- User menu items -->
                        </ul>
                    </div>
                </div>
            </nav>
        </div>

        <div class="content-inner container-fluid pb-0" id="page_layout">

            <!-- Breadcrumb -->
            <div class="d-flex align-items-center mb-4 pb-3 pt-3">
                <svg class="icon-18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M9.15722 20.7714V17.7047C9.1572 16.9246 9.79312 16.2908 10.581 16.2856H13.4671C14.2587 16.2856 14.9005 16.9209 14.9005 17.7047V17.7047V20.7809C14.9003 21.4432 15.4343 21.9845 16.103 22H18.0271C19.9451 22 21.5 20.4607 21.5 18.5618V18.5618V9.83784C21.4898 9.09083 21.1355 8.38935 20.538 7.93303L13.9577 2.6853C12.8049 1.77157 11.1662 1.77157 10.0134 2.6853L3.46203 7.94256C2.86226 8.39702 2.50739 9.09967 2.5 9.84736V18.5618C2.5 20.4607 4.05488 22 5.97291 22H7.89696C8.58235 22 9.13797 21.4499 9.13797 20.7714V20.7714" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
                <svg class="mx-1 icon-18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8.5 5L15.5 12L8.5 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
                <a href="./doctor-dashboard.html" class="text-decoration-none">Dashboard</a>
                <svg class="mx-1 icon-18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8.5 5L15.5 12L8.5 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
                <a href="./patient-schedule.html" class="text-decoration-none">Chi tiết lịch khám</a>
                <svg class="mx-1 icon-18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8.5 5L15.5 12L8.5 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
                <a href="javascript:history.back()" class="text-decoration-none">Hồ sơ bệnh án</a>
                <svg class="mx-1 icon-18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M8.5 5L15.5 12L8.5 19" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
                </svg>
                <span class="head-title fw-500 mt-1">Tạo hồ sơ bệnh án</span>
            </div>

            <!-- Action Buttons -->
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <button type="button" class="btn btn-outline-secondary" onclick="goBack()">
                        <i class="fas fa-arrow-left"></i> Quay lại
                    </button>
                </div>
                <div>
                    <button type="button" class="btn btn-outline-warning me-2" onclick="saveDraft()" id="saveDraftBtn">
                        <i class="fas fa-save"></i> Lưu nháp
                    </button>
                    <button type="button" class="btn btn-success" onclick="submitForm()" id="submitBtn">
                        <i class="fas fa-check"></i> Hoàn thành
                    </button>
                </div>
            </div>

            <!-- Patient Info Section -->
            <div class="card mb-4">
                <div class="card-header">
                    <h6 class="mb-0 text-primary">
                        <i class="fas fa-user me-2"></i>Thông tin bệnh nhân
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row" id="patientInfo">
                        <div class="col-12 text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Đang tải...</span>
                            </div>
                            <p class="mt-2 text-muted">Đang tải thông tin bệnh nhân...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Medical Record Form -->
            <form id="medicalRecordForm" class="needs-validation" novalidate>
                
                <!-- Basic Information Section -->
                <div class="form-section">
                    <h6 class="text-primary mb-3">
                        <i class="fas fa-info-circle me-2"></i>Thông tin cơ bản
                    </h6>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
    <label for="appointmentId" class="form-label">
        ID Cuộc hẹn <span class="required">*</span>
    </label>
    <input type="number" class="form-control" id="appointmentId" required>
    <div class="invalid-feedback">Vui lòng nhập ID cuộc hẹn</div>
</div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="diseaseSelect" class="form-label">
                                Bệnh <span class="required">*</span>
                            </label>
                            <select class="form-select" id="diseaseSelect" required>
                                <option value="">-- Chọn bệnh --</option>
                                <!-- Options will be loaded by JS -->
                            </select>
                            <div class="invalid-feedback">Vui lòng chọn bệnh</div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="status" class="form-label">
                                Trạng thái <span class="required">*</span>
                            </label>
                            <select class="form-select" id="status" required>
                                <option value="Open">Đang mở</option>
                                <option value="InProgress">Đang xử lý</option>
                                <option value="Closed">Đã đóng</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6 mb-3">
    <label for="prescriptionId" class="form-label">Mã Đơn thuốc</label>
    <div class="input-group">
        <input type="number" class="form-control" id="prescriptionId" placeholder="Nhập ID đơn thuốc">
        <button type="button" class="btn btn-outline-primary" id="createPrescriptionBtn">
            Tạo đơn thuốc
        </button>
    </div>
    <div class="invalid-feedback">Vui lòng nhập mã đơn thuốc nếu có</div>
</div>
                </div>

                <!-- Medical Details Section -->
                <div class="form-section">
                    <h6 class="text-primary mb-3">
                        <i class="fas fa-stethoscope me-2"></i>Chi tiết y tế
                    </h6>
                    
                    <div class="mb-3">
                        <label for="diagnosis" class="form-label">
                            Chẩn đoán <span class="required">*</span>
                        </label>
                        <textarea class="form-control" id="diagnosis" rows="4" 
                                  placeholder="Nhập chẩn đoán chi tiết..." 
                                  maxlength="1000" required></textarea>
                        <div class="d-flex justify-content-between">
                            <div class="invalid-feedback">Vui lòng nhập chẩn đoán</div>
                            <small class="char-counter" id="diagnosisCounter">0/1000</small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="testResults" class="form-label">
                            Kết quả xét nghiệm <span class="required">*</span>
                        </label>
                        <textarea class="form-control" id="testResults" rows="6" 
                                  placeholder="Nhập kết quả xét nghiệm, chỉ số, hình ảnh..." 
                                  maxlength="2000" required></textarea>
                        <div class="d-flex justify-content-between">
                            <div class="invalid-feedback">Vui lòng nhập kết quả xét nghiệm</div>
                            <small class="char-counter" id="testResultsCounter">0/2000</small>
                        </div>
                    </div>
                </div>

                <!-- Additional Notes Section -->
                <div class="form-section">
                    <h6 class="text-primary mb-3">
                        <i class="fas fa-sticky-note me-2"></i>Ghi chú bổ sung
                    </h6>
                    
                    <div class="mb-3">
                        <label for="notes" class="form-label">Ghi chú</label>
                        <textarea class="form-control" id="notes" rows="4" 
                                  placeholder="Ghi chú thêm, lưu ý đặc biệt..." 
                                  maxlength="500"></textarea>
                        <small class="char-counter" id="notesCounter">0/500</small>
                    </div>
                </div>

                <!-- Hidden fields -->
                <input type="hidden" id="patientId">
                <input type="hidden" id="doctorId">

            </form>

        </div>
    </main>

    <!-- Loading Modal -->
    <div class="modal fade" id="loadingModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-body text-center py-4">
                    <div class="spinner-border text-primary mb-3" role="status">
                        <span class="visually-hidden">Đang xử lý...</span>
                    </div>
                    <h5 id="loadingText">Đang lưu hồ sơ bệnh án...</h5>
                    <p class="text-muted mb-0">Vui lòng đợi trong giây lát</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./assets/js/core/libs.min.js"></script>
    <script src="./assets/js/kivicare.js"></script>
    <script src="./assets/js/medical-record.js"></script>
</body>
</html>